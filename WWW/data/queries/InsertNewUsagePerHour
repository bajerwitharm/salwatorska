INSERT INTO usage_by_hour(timestamp,user_id, data_in, data_out) SELECT timestamp,user_id,sum(data_in) as data_in,sum(data_out) as data_out from usage where timestamp>ifnull((select max(timestamp) from usage_by_hour),0) group by user_id, strftime('%s',timestamp)/3600; 